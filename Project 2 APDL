! =================================================!
! ANSYS APDL-scripts - Simple Bone
!     - Bone
!    -----------------------------------------
!       Geometry: [m]
!       Force:    [N]
!       Moment:   [Nm]
!       Pressure: [Pa]
! =================================================!

FINISH		 ! Make sure current ANSYS module is closed
/CLEAR,START ! Clear the ANSYS workspace 

! White background
/RGB,INDEX,100,100,100, 0   
/RGB,INDEX, 80, 80, 80,13   
/RGB,INDEX, 60, 60, 60,14   
/RGB,INDEX, 0, 0, 0,15  

! =================================================!
! INPUT DATA - including material
! =================================================!

PI = 4*ATAN(1.0) ! Define variable PI as 3.1415...

! Remember to update title
*dim,TITLE_TEXT,string,20 ! Maximum 20 characters
/TITLE,%TITLE_TEXT(1)% Project 2

YOUNG_COMPACT = 19e3  ![N/mm^2]
YOUNG_SPONGY = 10e3   ![N/mm^2]
YOUNG_MARROW = 0.001e3 ![N/mm^2]
POISSON_COMPACT = 0.4         !E.g. steel: 0.3 [-]
POISSON_SPONGY = 0.2
POISSON_MARROW = 0.3
TIMO = 1000*YOUNG_COMPACT

WEIGHT = 400 ![N]

! =================================================!
! GEOMETRY DEFINITIONS - in preprocessor (/PREP7)
! =================================================!
/PREP7 ! Enter the preprocessor

*ASK,FORCETYPE,Select force of bodyweight: 1=>Distributed 2=>Point force
*ASK,KNEEJOINT,Select boundary in knee: 1=>Fully clamped 2=>Can rotate in kneejoint 3=>Cartilage in knee
*ASK,BONETYPE,Select bonetype: 1=>Compact bone 2=>Composite bone,1        ! Asks what model to use

!Keypoints
K,1,0,232.3125,0
K,2,-6.1733,-242.3125,0
K,3,1,233.3125,0
K,4,8,239.3125,0
K,5,12,241.3125,0
K,6,19,242.3125,0
K,7,22,242.3125,0
K,8,30,241.3125,0
K,9,35,240.3125,0
K,10,37,239.3125,0
K,11,42,235.3125,0
K,12,44,232.3125,0
K,13,45,229.3125,0
K,14,45,223.3125,0
K,15,46,218.3125,0
K,16,48,213.3125,0
K,17,52,209.3125,0
K,18,57,206.3125,0
K,19,59,205.3125,0
K,20,63,207.3125,0
K,21,67,209.3125,0
K,22,78,209.3125,0
K,23,83,206.3125,0
K,24,86,201.3125,0
K,25,88,193.3125,0
K,26,89,184.3125,0
K,27,89,179.3125,0
K,28,88,173.3125,0
K,29,87,169.3125,0
K,30,86,166.3125,0
K,31,84,166.3125,0
K,32,81,164.3125,0
K,33,78,160.3125,0
K,34,74,153.3125,0
K,35,66,134.3125,0
K,36,64,128.3125,0
K,37,62,122.3125,0
K,38,59,112.3125,0
K,39,57,106.3125,0
K,40,55,101.3125,0
K,41,52,94.3125,0
K,42,49,87.3125,0
K,43,47,81.3125,0
K,44,45,73.3125,0
K,45,43,67.3125,0
K,46,41,60.3125,0
K,47,39,54.3125,0
K,48,36,43.3125,0
K,49,35,39.3125,0
K,50,33,30.3125,0
K,51,32,25.3125,0
K,52,31,21.3125,0
K,53,27,6.3125,0
K,54,23.2353,-8.6875,0
K,55,19,-26.6875,0
K,56,16.4118,-37.6875,0
K,57,13,-58.6875,0
K,58,10,-83.6875,0
K,59,5,-111.6875,0
K,60,0,-142.6875,0
K,61,0,-172.6875,0
K,62,4,-189.6875,0
K,63,8,-197.6875,0
K,64,10,-206.6875,0
K,65,9,-216.6875,0
K,66,7,-228.6875,0
K,67,5,-235.6875,0
K,68,0,-240.6875,0
K,69,-13,-241.6875,0
K,70,-22,-238.6875,0
K,71,-30,-234.5819,0
K,72,-34,-231.6875,0
K,73,-38,-229.6875,0
K,74,-40,-229.6875,0
K,75,-47,-232.6875,0
K,76,-54,-237.6875,0
K,77,-62,-239.6875,0
K,78,-73,-239.6875,0
K,79,-79,-236.6875,0
K,80,-82,-233.6875,0
K,81,-83,-228.6875,0
K,82,-86,-222.6875,0
K,83,-89,-214.6875,0
K,84,-86,-197.6875,0
K,85,-84,-190.6875,0
K,86,-78,-184.6875,0
K,87,-73,-180.6875,0
K,88,-67,-174.6875,0
K,89,-61,-165.6875,0
K,90,-51,-142.6875,0
K,91,-46,-126.6875,0
K,92,-41,-111.6875,0
K,93,-37,-96.6875,0
K,94,-35,-86.6875,0
K,95,-30,-68.6875,0
K,96,-23,-47.6875,0
K,97,-17.1176,-27.6875,0
K,98,-12,-7.6875,0
K,99,-9.1176,6.3125,0
K,100,-5.5882,21.3125,0
K,101,-3,32.3125,0
K,102,2,49.3125,0
K,103,5,62.3125,0
K,104,8,72.3125,0
K,105,11,84.3125,0
K,106,17,105.3125,0
K,107,20,115.3125,0
K,108,21,121.3125,0
K,109,22,126.3125,0
K,110,23,130.3125,0
K,111,23,133.3125,0
K,112,21,138.3125,0
K,113,20,143.3125,0
K,114,21,149.3125,0
K,115,24,152.3125,0
K,116,24,154.3125,0
K,117,23,162.3125,0
K,118,21,172.3125,0
K,119,20,176.3125,0
K,120,19,181.3125,0
K,121,16,189.3125,0
K,122,13,193.3125,0
K,123,10,196.3125,0
K,124,6,197.3125,0
K,125,4,198.3125,0
K,126,2,201.3125,0
K,127,0,204.3125,0
K,128,-2,206.3125,0
K,129,-3,208.3125,0
K,130,-4,214.3125,0
K,131,-4,218.3125,0
K,132,-3,225.3125,0

!Lines
L,1,3 
L,3,4
L,4,5
L,5,6
L,6,7
L,7,8
L,8,9
L,9,10
L,10,11
L,11,12
L,12,13
L,13,14
L,14,15
L,15,16
L,16,17
L,17,18
L,18,19
L,19,20
L,20,21
L,21,22
L,22,23
L,23,24
L,24,25
L,25,26
L,26,27
L,27,28
L,28,29
L,29,30
L,30,31
L,31,32
L,32,33
L,33,34
L,34,35
L,35,36
L,36,37
L,37,38
L,38,39
L,39,40
L,40,41
L,41,42
L,42,43
L,43,44
L,44,45
L,45,46
L,46,47
L,47,48
L,48,49
L,49,50
L,50,51
L,51,52
L,52,53
L,53,54
L,54,55
L,55,56
L,56,57
L,57,58
L,58,59
L,59,60
L,60,61
L,61,62
L,62,63
L,63,64
L,64,65
L,65,66
L,66,67
L,67,68
L,68,2
L,2,69
L,69,70
L,70,71
L,71,72
L,72,73
L,73,74
L,74,75
L,75,76
L,76,77
L,77,78
L,78,79
L,79,80
L,80,81
L,81,82
L,82,83
L,83,84
L,84,85
L,85,86
L,86,87
L,87,88
L,88,89
L,89,90
L,90,91
L,91,92
L,92,93
L,93,94
L,94,95
L,95,96
L,96,97
L,97,98
L,98,99
L,99,100
L,100,101
L,101,102
L,102,103
L,103,104
L,104,105
L,105,106
L,106,107
L,107,108
L,108,109
L,109,110
L,110,111
L,111,112
L,112,113
L,113,114
L,114,115
L,115,116
L,116,117
L,117,118
L,118,119
L,119,120
L,120,121
L,121,122
L,122,123
L,123,124
L,124,125
L,125,126
L,126,127
L,127,128
L,128,129
L,129,130
L,130,131
L,131,132
L,132,1

AL,all      ! Area from all lines

*IF,KNEEJOINT,EQ,3,THEN
/AUX15  
!*  
IOPTN,IGES,SMOOTH   
IOPTN,MERGE,YES 
IOPTN,SOLID,YES 
IOPTN,SMALL,YES 
IOPTN,GTOLER, DEFA  
IGESIN,'Only cartilage_attempt','igs','..\Bone\'

     !133 -216.0000      17.64884     -2610.351         0.0000   0.0000   0.0000  x=-216-(-89)=-127, y= 17.64884-(-214.6875)=232.33634 z=-2610.351 
     !134 -181.0000     -5.351163     -2610.351         0.0000   0.0000   0.0000
     !135 -157.0000     -2.245532     -2610.351         0.0000   0.0000   0.0000
     !136 -118.0000      15.64884     -2610.351         0.0000   0.0000   0.0000
     

/PREP7 ! Enter the preprocessor
LGEN,2,133,134,,127,-232.33634,2610.351,,,1
NUMMRG,KP,0.001
*ENDIF

AL,76,77,78,79,80,81,82,133
AL,64,65,66,67,68,69,70,134

! =================================================!
! MATERIAL DEFINITIONS
! =================================================! 

MP,EX,1,YOUNG_COMPACT
MP,PRXY,1,POISSON_COMPACT
MP,EX,2,YOUNG_SPONGY
MP,PRXY,2,POISSON_SPONGY
MP,EX,3,YOUNG_MARROW
MP,PRXY,3,POISSON_MARROW

! =================================================!
! ELEMENT DEFINITIONS AND MESHING
! =================================================!

*IF,BONETYPE,EQ,1,THEN
ET,1,PLANE183
MSHAPE,0,2D
LESIZE,ALL,2,,,

*ELSEIF,BONETYPE,EQ,2,THEN
ET,1,PLANE183
*ENDIF

TYPE,1
MAT,1
AMESH,ALL

! =================================================!
! DEFINE BOUNDARY CONDITIONS AND LOADS
! =================================================! 

*IF,KNEEJOINT,EQ,1,THEN
NSEL,S,LOC,Y,-214.6875
D,ALL,,,,,,ALL
NSEL,ALL

*ELSEIF,KNEEJOINT,EQ,2,THEN
KSEL,S,KP,,73,73
NSLK,S
D,ALL,,,,,,UX,UY
KSEL,ALL
NSEL,ALL

KSEL,S,KP,,6,6
NSLK,S
D,ALL,,,,,,UX
*ENDIF

*IF,FORCETYPE,EQ,1,THEN
LSEL,S,LINE,,1,10
NSLL,S,1
*GET,tnum,NODE,0,COUNT,,,
F,ALL,FY,-WEIGHT/tnum
NSEL,ALL

*ELSEIF,FORCETYPE,EQ,2,THEN
FK,6,FY,-WEIGHT
*ENDIF

FINISH	! Exit the preprocessor

! =================================================!
! SOLUTION - in solution (/SOL)
! =================================================!

/SOL	! Enter the solution module







SOLVE	! Obtain solution

FINISH	! Exit the solution module


! =================================================!
! STUDY RESULTS - in postprocessor (/POST1) 
! =================================================!
/POST1
SET,FIRST
PLDISP,2


FINISH
